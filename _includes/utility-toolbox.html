<style>
/* --- CSS VARIABLES FOR CONSISTENCY --- */
:root {
Â  --util-primary: #2d4d7a;
Â  --util-secondary: #e6f2ff;
Â  --util-text: #1e2a38;
Â  --util-danger: #c62828;
}

/* Hide sidebar when wide mode is active */
body.wide-mode .site-sidebar {
Â  display: none !important;
}

/* Expand main content when sidebar hidden */
body.wide-mode .page-content,
body.wide-mode main,
body.wide-mode .wrapper {
Â  width: 100% !important;
Â  max-width: 100% !important;
Â  float: none !important;
Â  padding-right: 0 !important;
}

/* Toolbox container */
#utilityToolboxContainer {
Â  position: fixed;
Â  bottom: 35px;
Â  right: 20px;
Â  z-index: 99999;
Â  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; /* Cleaner font stack */
Â  font-size: 14px;
Â  display: flex;
Â  flex-direction: column;
Â  align-items: flex-end;
}

/* Toolbox toggle button */
#toggleToolbox {
Â  background: var(--util-primary);
Â  color: #fff;
Â  border: none;
Â  padding: 10px 16px;
Â  border-radius: 6px;
Â  cursor: pointer;
Â  font-size: 14px;
Â  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

/* Toolbox panel */
#toolboxContent {
Â  display: none;
Â  margin-top: 8px;
Â  flex-direction: column;
Â  gap: 12px;
Â  align-items: stretch;
Â  background: #fff;
Â  padding: 14px;
Â  border-radius: 8px;
Â  color: #2c3e50;
Â  width: 240px;
Â  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

/* Style for section headings */
#toolboxContent div[style*="font-weight:bold"] {
Â  color: #005b96;
Â  font-size: 13px; /* Ensure consistency */
}

.utility-button, .utility-select {
Â  background: var(--util-secondary);
Â  color: var(--util-text);
Â  border: 1px solid #d0e4f7;
Â  padding: 8px 12px;
Â  border-radius: 6px;
Â  cursor: pointer;
Â  font-size: 14px;
Â  transition: background 0.2s;
}

.utility-button:hover, .utility-select:hover {
Â  background: #d0e4f7;
}

.utility-select {
Â  width: 100%;
}

.utility-button-group {
Â  display: flex;
Â  gap: 4px;
}

.utility-button-group .utility-button {
Â  flex-grow: 1;
}

#resetAllBtn {
Â  background: var(--util-danger) !important;
Â  color: #fff !important;
Â  margin-top: 8px;
}
#resetAllBtn:hover {
Â  background: #a02020 !important;
}

#backToTopBtn {
Â  position: fixed;
Â  bottom: 35px;
Â  left: 20px; /* Moved slightly for balance */
Â  background: var(--util-primary);
Â  color: #fff;
Â  border: none;
Â  border-radius: 6px;
Â  padding: 10px 14px; /* Larger padding for better hit area */
Â  font-size: 18px;
Â  cursor: pointer;
Â  z-index: 99997;
Â  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
Â  display: none;
}
</style>

<div id="utilityToolboxContainer">
Â  <button id="toggleToolbox" title="Toggle Utilities" aria-expanded="false" aria-controls="toolboxContent">
Â  Â  âš™ï¸ Utilities
Â  </button>
Â  <div id="toolboxContent" role="dialog" aria-label="Accessibility and View Tools">

Â  Â  <div style="text-align:center;font-weight:bold;font-size:16px;margin-bottom:8px;color:#002d62;">
Â  Â  Â  Utilities
Â  Â  </div>
Â  Â  Â  Â 
Â  Â <div style="font-weight:bold;margin-bottom:6px;">Translate</div>
Â  Â  Â  Â {% include translate.html %}
Â  Â Â 
Â  Â  Â  Â  <div>
Â  Â  Â  <div style="font-weight:bold;margin-bottom:6px;">ğŸ”¤ Font type</div>
Â  Â  Â  <select id="fontSelector" class="utility-select" aria-label="Select font family">
Â  Â  Â  Â  <option value="">Default</option>
Â  Â  Â  Â  <option value="arial">Arial</option>
Â  Â  Â  Â  <option value="georgia">Georgia</option>
Â  Â  Â  Â  <option value="opensans">Open Sans</option>
Â  Â  Â  Â  <option value="merriweather">Merriweather</option>
Â  Â  Â  Â  <option value="roboto">Roboto</option>
Â  Â  Â  Â  <option value="playfair">Playfair Display</option>
Â  Â  Â  Â  <option value="courier">Courier New</option>
Â  Â  Â  </select>
Â  Â  </div>

Â  Â  Â  Â  <div>
Â  Â  Â  <div style="font-weight:bold;margin-bottom:6px;">ğŸ“ Font size</div>
Â  Â  Â  <div class="utility-button-group">
Â  Â  Â  Â  <button id="textZoomIn" class="utility-button" aria-label="Increase font size">A+</button>
Â  Â  Â  Â  <button id="textZoomOut" class="utility-button" aria-label="Decrease font size">Aâˆ’</button>
Â  Â  Â  Â  <button id="textZoomReset" class="utility-button" aria-label="Reset font size">ğŸ”</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div>
Â  Â  Â  <div style="font-weight:bold;margin-bottom:6px;">ğŸ“ Line height</div>
Â  Â  Â  <div class="utility-button-group">
Â  Â  Â  Â  <button id="lineHeightIncrease" class="utility-button" aria-label="Increase line height">â¬†ï¸</button>
Â  Â  Â  Â  <button id="lineHeightDecrease" class="utility-button" aria-label="Decrease line height">â¬‡ï¸</button>
Â  Â  Â  Â  <button id="lineHeightReset" class="utility-button" aria-label="Reset line height">ğŸ”</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  Â  Â  <div>
Â  Â  Â  <div style="font-weight:bold;margin-bottom:6px;">ğŸ– Font colour</div>
Â  Â  Â  <select id="fontColorSelect" class="utility-select" aria-label="Select font colour">
Â  Â  Â  Â  <option value="">Default</option>
Â  Â  Â  Â  <option value="darkgreen">Dark Green</option>
Â  Â  Â  Â  <option value="darkred">Dark Red</option>
Â  Â  Â  Â  <option value="indigo">Indigo</option>
Â  Â  Â  Â  <option value="maroon">Maroon</option>
Â  Â  Â  Â  <option value="midnightblue">Midnight Blue</option>
Â  Â  Â  Â  <option value="saddlebrown">Saddle Brown</option>
Â  Â  Â  </select>
Â  Â  </div>

Â  Â  Â  Â  <div>
Â  Â  Â  <div style="font-weight:bold;margin-bottom:6px;">ğŸ¨ Background</div>
Â  Â  Â  <select id="bgColorSelect" class="utility-select" aria-label="Select background colour">
Â  Â  Â  Â  <option value="">Default</option>
Â  Â  Â  Â  <option value="aliceblue">Alice Blue</option>
Â  Â  Â  Â  <option value="beige">Beige</option>
Â  Â  Â  Â  <option value="floralwhite">Floral White</option>
Â  Â  Â  Â  <option value="honeydew">Mint</option>
Â  Â  Â  Â  <option value="ivory">Ivory</option>
Â  Â  Â  Â  <option value="lavenderblush">Lavender</option>
Â  Â  Â  Â  <option value="lemonchiffon">Lemon</option>
Â  Â  Â  Â  <option value="lightgrey">Light Grey</option>
Â  Â  Â  Â  <option value="mintcream">Mint Cream</option>
Â  Â  Â  Â  <option value="whitesmoke">White Smoke</option>
Â  Â  Â  </select>
Â  Â  </div>

Â  Â  Â  Â  <div style="text-align:center;">
Â  Â  Â  <button id="resetAllBtn" aria-label="Reset all settings to default">
Â  Â  Â  Â  ğŸ”„ Reset All
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>
</div>

<button id="backToTopBtn" title="Back to Top" aria-label="Scroll to top of page">â¬†ï¸</button>

<script>
window.addEventListener("load", function () {
Â  const body = document.body;
Â  const toggleBtn = document.getElementById("toggleToolbox");
Â  const toolbox = document.getElementById("toolboxContent");
Â  const contentSelectors = "main, article, .page-content, .wrapper"; // Elements to apply content styles to

Â  // --- Toolbox Toggle ---
Â  toggleBtn.onclick = () => {
Â  Â  const expanded = toolbox.style.display === "flex";
Â  Â  toolbox.style.display = expanded ? "none" : "flex";
Â  Â  toggleBtn.setAttribute('aria-expanded', !expanded);
Â  Â  toggleBtn.textContent = expanded ? "âš™ï¸ Utilities" : "âŒ Close";
Â  };

Â  // --- Font Size ---
Â  let fontSize = parseFloat(localStorage.getItem("zoomFontSize")) || 100;
Â  function applyFontSize() {
Â  Â  // Apply to body to affect all elements consistently
Â  Â  body.style.setProperty("font-size", fontSize + "%", "important");
Â  Â  localStorage.setItem("zoomFontSize", fontSize);
Â  }
Â  document.getElementById("textZoomIn").onclick = () => { if (fontSize < 200) { fontSize += 10; applyFontSize(); }};
Â  document.getElementById("textZoomOut").onclick = () => { if (fontSize > 60) { fontSize -= 10; applyFontSize(); }};
Â  document.getElementById("textZoomReset").onclick = () => { fontSize = 100; applyFontSize(); };
Â  applyFontSize();

Â  // --- Line Height ---
Â  let lineHeight = parseFloat(localStorage.getItem("customLineHeight")) || 1.6;
Â  function applyLineHeight() {
Â  Â  // Apply line-height to main content areas
Â  Â  document.querySelectorAll(contentSelectors).forEach(el => el.style.setProperty("line-height", lineHeight, "important"));
Â  Â  localStorage.setItem("customLineHeight", lineHeight);
Â  }
Â  // Math.round to fix floating point arithmetic issues
Â  document.getElementById("lineHeightIncrease").onclick = () => { if (lineHeight < 3) { lineHeight = Math.round((lineHeight + 0.1) * 10) / 10; applyLineHeight(); }};
Â  document.getElementById("lineHeightDecrease").onclick = () => { if (lineHeight > 1) { lineHeight = Math.round((lineHeight - 0.1) * 10) / 10; applyLineHeight(); }};
Â  document.getElementById("lineHeightReset").onclick = () => { lineHeight = 1.6; applyLineHeight(); };
Â  applyLineHeight();

Â  // --- Font Family (Lazy Loading Google Fonts) ---
Â  const fontSelector = document.getElementById("fontSelector");
Â  const fontMap = {
Â  Â  arial: "Arial, sans-serif",
Â  Â  courier: "'Courier New', monospace",
Â  Â  georgia: "Georgia, serif",
Â  Â  opensans: "'Open Sans', sans-serif",
Â  Â  merriweather: "'Merriweather', serif",
Â  Â  playfair: "'Playfair Display', serif",
Â  Â  roboto: "'Roboto', sans-serif"
Â  };
Â  const googleFontUrls = {
Â  Â  opensans: 'https://fonts.googleapis.com/css2?family=Open+Sans&display=swap',
Â  Â  merriweather: 'https://fonts.googleapis.com/css2?family=Merriweather&display=swap',
Â  Â  playfair: 'https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap',
Â  Â  roboto: 'https://fonts.googleapis.com/css2?family=Roboto&display=swap'
Â  };
Â  
Â  function loadGoogleFont(key) {
Â  Â  const url = googleFontUrls[key];
Â  Â  if (url && !document.querySelector(`link[href="${url}"]`)) {
Â  Â  Â  const link = document.createElement('link');
Â  Â  Â  link.href = url;
Â  Â  Â  link.rel = 'stylesheet';
Â  Â  Â  document.head.appendChild(link);
Â  Â  }
Â  }

Â  function applyFontFamily(key) {
Â  Â  if (googleFontUrls[key]) {
Â  Â  Â  loadGoogleFont(key);
Â  Â  }
Â  Â  const val = fontMap[key] || "";
Â  Â  document.querySelectorAll(contentSelectors).forEach(el => el.style.setProperty("font-family", val, "important"));
Â  Â  localStorage.setItem("fontFamily", key || "");
Â  }

Â  fontSelector.onchange = () => applyFontFamily(fontSelector.value);
Â  const savedFont = localStorage.getItem("fontFamily");
Â  if (savedFont) { 
Â  Â  fontSelector.value = savedFont; 
Â  Â  applyFontFamily(savedFont); // Initial load applies font and lazy-loads if needed
Â  }

Â  // --- Font Colour ---
Â  const fontColorSelect = document.getElementById("fontColorSelect");
Â  const applyFontColor = (color) => {
Â  Â  document.querySelectorAll(contentSelectors).forEach(el => el.style.setProperty("color", color, "important"));
Â  Â  localStorage.setItem("fontColor", color || "");
Â  };

Â  fontColorSelect.onchange = () => applyFontColor(fontColorSelect.value);
Â  const savedFontColor = localStorage.getItem("fontColor");
Â  if (savedFontColor) {
Â  Â  applyFontColor(savedFontColor);
Â  Â  fontColorSelect.value = savedFontColor;
Â  }

Â  // --- Background Colour ---
Â  const bgSelect = document.getElementById("bgColorSelect");
Â  const applyBackground = (bg) => {
Â  Â  // Apply to body and html for full coverage
Â  Â  body.style.setProperty("background-color", bg || "", "important");
Â  Â  document.documentElement.style.setProperty("background-color", bg || "", "important");
Â  Â  
Â  Â  // Apply to content wrappers to handle nested elements/theme colours
Â  Â  document.querySelectorAll(contentSelectors).forEach(el => {
Â  Â  Â  el.style.setProperty("background-color", bg || "", "important");
Â  Â  });
Â  Â  body.style.transition = "background-color 0.4s ease";
Â  };

Â  bgSelect.onchange = () => applyBackground(bgSelect.value);
Â  const savedBg = localStorage.getItem("bgColor");
Â  if (savedBg) {
Â  Â  applyBackground(savedBg);
Â  Â  bgSelect.value = savedBg;
Â  }

Â  // --- Reset all ---Â 
Â  document.getElementById("resetAllBtn").onclick = () => {
Â  Â  ["zoomFontSize", "customLineHeight", "fontFamily", "fontColor", "bgColor", "sidebarHidden"].forEach(k => localStorage.removeItem(k));
Â  Â  
Â  Â  // Reset variables to defaults
Â  Â  fontSize = 100; lineHeight = 1.6;
Â  Â  
Â  Â  // Clear all inline styles
Â  Â  body.classList.remove("wide-mode");
Â  Â  body.style.removeProperty("font-size");
Â  Â  body.style.removeProperty("background-color");
Â  Â  document.documentElement.style.removeProperty("background-color");
Â  Â  document.querySelectorAll(contentSelectors).forEach(el => {
Â  Â  Â  el.style.removeProperty("line-height");
Â  Â  Â  el.style.removeProperty("font-family");
Â  Â  Â  el.style.removeProperty("color");
Â  Â  Â  el.style.removeProperty("background-color");
Â  Â  });
Â  Â  
Â  Â  // Reset dropdowns
Â  Â  fontSelector.value = ""; 
Â  Â  fontColorSelect.value = ""; 
Â  Â  bgSelect.value = "";

Â  Â  // Reapply defaults from local storage (which is now empty, so defaults run)
Â  Â  applyFontSize(); 
Â  Â  applyLineHeight();
Â  };

Â  // --- Back to top ---
Â  const topBtn = document.getElementById("backToTopBtn");
Â  // Use requestAnimationFrame for smoother scroll checks
Â  let ticking = false;
Â  window.addEventListener("scroll", () => {
Â  Â  if (!ticking) {
Â  Â  Â  window.requestAnimationFrame(() => {
Â  Â  Â  Â  topBtn.style.display = window.scrollY > 300 ? "block" : "none";
Â  Â  Â  Â  ticking = false;
Â  Â  Â  });
Â  Â  Â  ticking = true;
Â  Â  }
Â  });
Â  topBtn.onclick = () => window.scrollTo({ top: 0, behavior: "smooth" });
});
</script>
